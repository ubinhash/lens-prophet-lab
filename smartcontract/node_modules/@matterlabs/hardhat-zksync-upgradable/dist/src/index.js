"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", { value: true });
require("@matterlabs/hardhat-zksync-solc");
require("@matterlabs/hardhat-zksync-ethers");
require("./type-extensions");
const config_env_1 = require("hardhat/internal/core/config/config-env");
const task_names_1 = require("hardhat/builtin-tasks/task-names");
const utils_general_1 = require("./utils/utils-general");
const validate_1 = require("./core/validate");
const task_names_2 = require("./task-names");
const task_actions_1 = require("./task-actions");
const generator_1 = require("./generator");
const errors_1 = require("./errors");
require("@matterlabs/hardhat-zksync-telemetry");
(0, config_env_1.extendEnvironment)((hre) => {
    const extesionGenerator = new generator_1.ExtensionGenerator(hre);
    extesionGenerator.populateExtension();
});
(0, config_env_1.task)(task_names_2.TASK_DEPLOY_ZKSYNC_BEACON, 'Runs the beaccon deploy for ZKsync network')
    .addParam('contractName', 'A contract name or a FQN', '')
    .addOptionalVariadicPositionalParam('constructorArgsParams', 'Contract constructor arguments. Cannot be used if the --constructor-args option is provided', [])
    .addOptionalParam('constructorArgs', 'Path to a Javascript module that exports the constructor arguments', undefined, config_env_1.types.inputFile)
    .addOptionalParam('initializer', 'Initializer function name', undefined)
    .addOptionalParam('deploymentTypeImpl', 'Type of deployment for implementation', undefined)
    .addOptionalParam('deploymentTypeProxy', 'Type of deployment for proxy', undefined)
    .addOptionalParam('saltImpl', 'Salt for implementation deployment', undefined)
    .addOptionalParam('saltProxy', 'Salt for proxy deployment', undefined)
    .addOptionalParam('initialOwner', 'Initial owner of the proxy', undefined)
    .addFlag('noCompile', 'No compile flag')
    .setAction(task_actions_1.deployZkSyncBeacon);
(0, config_env_1.task)(task_names_2.TASK_DEPLOY_ZKSYNC_PROXY, 'Deploy proxy for ZKsync network')
    .addParam('contractName', 'A contract name or a FQN', '')
    .addOptionalVariadicPositionalParam('constructorArgsParams', 'Contract constructor arguments. Cannot be used if the --constructor-args option is provided', [])
    .addOptionalParam('constructorArgs', 'Path to a Javascript module that exports the constructor arguments', undefined, config_env_1.types.inputFile)
    .addOptionalParam('initializer', 'Initializer function name', undefined)
    .addOptionalParam('deploymentTypeImpl', 'Type of deployment for implementation', undefined)
    .addOptionalParam('deploymentTypeProxy', 'Type of deployment for proxy', undefined)
    .addOptionalParam('saltImpl', 'Salt for implementation deployment', undefined)
    .addOptionalParam('saltProxy', 'Salt for proxy deployment', undefined)
    .addOptionalParam('initialOwner', 'Initial owner of the proxy', undefined)
    .addFlag('noCompile', 'No compile flag')
    .setAction(task_actions_1.deployZkSyncProxy);
(0, config_env_1.task)(task_names_2.TASK_UPGRADE_ZKSYNC_BEACON, 'Runs the beacon upgrade for ZKsync network')
    .addParam('contractName', 'A contract name or a FQN', '')
    .addParam('beaconAddress', 'Beacon address of the deployed contract', '')
    .addOptionalParam('deploymentType', 'Type of deployment', undefined)
    .addOptionalParam('salt', 'Salt for deployment', undefined)
    .addFlag('noCompile', 'No compile flag')
    .setAction(task_actions_1.upgradeZkSyncBeacon);
(0, config_env_1.task)(task_names_2.TASK_UPGRADE_ZKSYNC_PROXY, 'Runs the proxy upgrade for ZKsync network')
    .addParam('contractName', 'A contract name or a FQN', '')
    .addParam('proxyAddress', 'Proxy address of the deployed contract', '')
    .addOptionalParam('deploymentType', 'Type of deployment', undefined)
    .addOptionalParam('salt', 'Salt for deployment', undefined)
    .addFlag('noCompile', 'No compile flag')
    .setAction(task_actions_1.upgradeZkSyncProxy);
(0, config_env_1.subtask)(task_names_1.TASK_COMPILE_SOLIDITY_COMPILE, async (args, hre, runSuper) => {
    const { solcInputOutputDecoder } = await Promise.resolve().then(() => __importStar(require('@openzeppelin/upgrades-core')));
    const { writeValidations } = await Promise.resolve().then(() => __importStar(require('./validations/validations')));
    const { output, solcBuild } = await runSuper();
    if ((0, utils_general_1.isFullZkSolcOutput)(output)) {
        const decodeSrc = solcInputOutputDecoder(args.input, output);
        const validations = (0, validate_1.validate)(output, decodeSrc, args.solcVersion);
        await writeValidations(hre, validations);
    }
    return { output, solcBuild };
});
(0, config_env_1.subtask)('verify:etherscan').setAction(async (args, hre, runSuper) => {
    if (!hre.network.zksync) {
        // eslint-disable-next-line @typescript-eslint/no-shadow
        const { verify } = await Promise.resolve().then(() => __importStar(require('@openzeppelin/hardhat-upgrades/dist/verify-proxy')));
        return await verify(args, hre, runSuper);
    }
    const { verify } = await Promise.resolve().then(() => __importStar(require('./verify/verify-proxy')));
    return await verify(args, hre, runSuper);
});
(0, config_env_1.subtask)('verify:zksync-etherscan').setAction(async (args, hre, runSuper) => {
    if (!hre.network.zksync) {
        throw new errors_1.ZkSyncUpgradablePluginError('This task is only available for zkSync network, use `verify:verify` instead');
    }
    const { verify } = await Promise.resolve().then(() => __importStar(require('./verify/verify-proxy')));
    return await verify(args, hre, runSuper);
});
(0, config_env_1.subtask)('verify:zksync-blockexplorer').setAction(async (args, hre, runSuper) => {
    if (!hre.network.zksync) {
        throw new errors_1.ZkSyncUpgradablePluginError('This task is only available for zkSync network, use `verify:verify` instead');
    }
    const { verify } = await Promise.resolve().then(() => __importStar(require('./verify/verify-proxy')));
    return await verify(args, hre, runSuper);
});
__exportStar(require("./type-extensions"), exports);
//# sourceMappingURL=index.js.map